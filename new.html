<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>×“×™×•×•×— ×—×“×©</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div class="card">
    <div class="tabs">
      <a class="tab" href="index.html">×“×£ ×”×‘×™×ª</a>
      <a class="tab" id="backSite" href="#">×—×–×¨×” ×œ××ª×§×Ÿ</a>
      <a class="tab active" href="#">×“×™×•×•×— ×—×“×©</a>
    </div>

    <h2 id="hdr">×“×™×•×•×— ×—×“×©</h2>

    <div class="step" id="s1">
      <h3>×“×™×•×•×— ×—×“×© â€“ ×©×œ×‘ 1 ××ª×•×š 3</h3>
      <p class="muted">×‘×—×¨ ××ª ×”××–×•×¨ ×‘××ª×§×Ÿ ×•×¡×•×’ ×”×‘×¢×™×”.</p>

      <label>××–×•×¨ ×‘××ª×§×Ÿ</label>
      <select id="area">
        <option value="">×‘×—×¨ ××–×•×¨â€¦</option>
        <option>×¡×œ×•×Ÿ</option>
        <option>××˜×‘×—</option>
        <option>×—×“×¨ ×©×™× ×”</option>
        <option>××§×œ×—×ª</option>
        <option>×©×™×¨×•×ª×™×</option>
        <option>××¨×¤×¡×ª</option>
        <option>×¢××“×ª × ×•×›×—</option>
        <option>××—×¨</option>
      </select>

      <label>×¡×•×’ ×”×‘×¢×™×”</label>
      <div class="btnRow">
        <button type="button" class="chip" data-type="××©×”×• ×—×¡×¨">××©×”×• ×—×¡×¨ ğŸ“¦</button>
        <button type="button" class="chip" data-type="××©×”×• ×”×ª×§×œ×§×œ">××©×”×• ×”×ª×§×œ×§×œ ğŸ”§</button>
        <button type="button" class="chip" data-type="××©×”×• ××—×¨">××©×”×• ××—×¨ â“</button>
      </div>

      <button class="btn" id="to2">×”××©×š ×œ×©×œ×‘ 2</button>
    </div>

    <div class="step hidden" id="s2">
      <h3>×“×™×•×•×— ×—×“×© â€“ ×©×œ×‘ 2 ××ª×•×š 3</h3>
      <p class="muted">×¤×¨×˜×™ ×”×¤×¨×™×˜ ×•×”×ª×™××•×¨.</p>

      <label>×¢×œ ××™×–×” ×¤×¨×™×˜?</label>
      <input id="item" placeholder="×œ×“×•×’××”: ×›×™×¡×, ××§×¨×¨, ××™×˜×”â€¦" />

      <label>×ª×™××•×¨ ×§×¦×¨</label>
      <textarea id="desc" placeholder="××” ×‘×“×™×•×§ ×”×‘×¢×™×”?"></textarea>

      <label>×“×—×™×¤×•×ª</label>
      <div>
        <label><input type="radio" name="urg" value="×§×¨×™×˜×™" /> ×§×¨×™×˜×™ (××™×/×—×©××œ/×’×–/×‘×˜×™×—×•×ª)</label><br/>
        <label><input type="radio" name="urg" value="×¨×’×™×œ" checked /> ×¨×’×™×œ</label>
      </div>

      <button class="btn secondary" id="back1">×—×–×¨×” ×œ×©×œ×‘ 1</button>
      <button class="btn" id="to3">×”××©×š ×œ×©×œ×‘ 3</button>
    </div>

    <div class="step hidden" id="s3">
      <h3>×“×™×•×•×— ×—×“×© â€“ ×©×œ×‘ 3 ××ª×•×š 3</h3>
      <p class="muted">×¡×™×›×•× ×œ×¤× ×™ ×©×œ×™×—×”.</p>

      <div class="summary" id="sum"></div>

      <div class="note" style="margin-top:12px;">
        <b>×ª××•× ×” (×œ× ×—×•×‘×”):</b> ×‘×’×¨×¡×” ×”×–××ª ×”×©××¨×ª×™ ××ª ×–×” ×œ×©×“×¨×•×’, ×›×™ ×”×¢×œ××ª ×§×•×‘×¥ ×“×•×¨×©×ª ×”×¨×©××•×ª Drive + ×©×™× ×•×™ API.
        ×× ×ª×¨×¦×” â€“ ×× ×™ ××ª×Ÿ ×œ×š ×’× ××ª ×’×¨×¡×ª "×”×¢×œ××ª ×ª××•× ×”" ×”××œ××”.
      </div>

      <button class="btn secondary" id="back2">×—×–×¨×” ×œ×©×œ×‘ 2</button>
      <button class="btn" id="send">×©×œ×— ×“×™×•×•×—</button>
    </div>
  </div>

<script src="app.js"></script>
<script>
  const site = qs("site") || "";
  document.getElementById("hdr").textContent = `×“×™×•×•×— ×—×“×© â€“ ${site}`;
  document.getElementById("backSite").href = `site.html?site=${encodeURIComponent(site)}`;

  let type = "";

  document.querySelectorAll(".chip").forEach(b=>{
    b.onclick = () => {
      type = b.dataset.type;
      document.querySelectorAll(".chip").forEach(x=>x.classList.remove("selected"));
      b.classList.add("selected");
    };
  });

  const s1 = document.getElementById("s1");
  const s2 = document.getElementById("s2");
  const s3 = document.getElementById("s3");

  document.getElementById("to2").onclick = () => {
    if (!document.getElementById("area").value || !type) return alert("×‘×—×¨ ××–×•×¨ ×•×¡×•×’ ×‘×¢×™×”");
    s1.classList.add("hidden"); s2.classList.remove("hidden");
    window.scrollTo({top:0, behavior:"smooth"});
  };
  document.getElementById("back1").onclick = () => { s2.classList.add("hidden"); s1.classList.remove("hidden"); window.scrollTo({top:0, behavior:"smooth"}); };
  document.getElementById("to3").onclick = () => {
    const area = document.getElementById("area").value;
    const item = document.getElementById("item").value.trim();
    const desc = document.getElementById("desc").value.trim();
    const urg = document.querySelector('input[name="urg"]:checked').value;

    if (!item || !desc) return alert("××œ× ×¤×¨×™×˜ ×•×ª×™××•×¨");

    document.getElementById("sum").innerHTML = `
      <h4>×¡×™×›×•× ×œ×¤× ×™ ×©×œ×™×—×”</h4>
      <div><b>××ª×—×:</b> ${escapeHtml(site)}</div>
      <div><b>××–×•×¨:</b> ${escapeHtml(area)}</div>
      <div><b>×¡×•×’:</b> ${escapeHtml(type)}</div>
      <div><b>×¤×¨×™×˜:</b> ${escapeHtml(item)}</div>
      <div><b>×ª×™××•×¨:</b> ${escapeHtml(desc)}</div>
      <div><b>×“×—×™×¤×•×ª:</b> ${escapeHtml(urg)}</div>
    `;
    s2.classList.add("hidden"); s3.classList.remove("hidden");
    window.scrollTo({top:0, behavior:"smooth"});
  };
  document.getElementById("back2").onclick = () => { s3.classList.add("hidden"); s2.classList.remove("hidden"); window.scrollTo({top:0, behavior:"smooth"}); };

  document.getElementById("send").onclick = async () => {
    const payload = {
      site,
      area: document.getElementById("area").value,
      type,
      item: document.getElementById("item").value.trim(),
      desc: document.getElementById("desc").value.trim(),
      urgency: document.querySelector('input[name="urg"]:checked').value,
      imageUrl: ""
    };

    try{
      const data = await apiCreate(payload);
      if (!data.ok) return alert("×©×’×™××” ×‘×©×œ×™×—×”");
      alert("×”×“×™×•×•×— × ×©×œ×— âœ…");
      location.href = `site.html?site=${encodeURIComponent(site)}`;
    }catch(e){
      alert("×©×’×™××” (×‘×“×•×§ API_URL / ×”×¨×©××•×ª Apps Script)");
    }
  };
</script>
</body>
</html>
